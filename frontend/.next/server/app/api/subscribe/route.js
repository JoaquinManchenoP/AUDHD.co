(()=>{var e={};e.id=374,e.ids=[374],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6487:()=>{},7965:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>c,serverHooks:()=>l,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>u});var a=r(6559),i=r(8088),n=r(7719),o=r(2190);async function u(e){try{let{email:t}=await e.json();if(!t||"string"!=typeof t)return o.NextResponse.json({error:"Email is required"},{status:400});let r=process.env.BEEHIIV_API_KEY,s=process.env.BEEHIIV_PUBLICATION_ID;if(!r||!s)return o.NextResponse.json({error:"Server is not configured with Beehiiv credentials"},{status:500});if(!s.startsWith("pub_"))return o.NextResponse.json({error:"BEEHIIV_PUBLICATION_ID must be the public id (format: pub_...), not a UUID."},{status:500});let a=e.headers.get("x-forwarded-for")||"",i=a.split(",")[0]?.trim(),n=e.headers.get("x-real-ip")||"",u=i||n||void 0,c=e.headers.get("user-agent")||void 0,d=e.headers.get("referer")||e.headers.get("referrer")||void 0,m=e.nextUrl,l=m.searchParams.get("utm_source")||void 0,h=m.searchParams.get("utm_medium")||void 0,v=m.searchParams.get("utm_campaign")||void 0,x=m.searchParams.get("utm_term")||void 0,g=m.searchParams.get("utm_content")||void 0,_={email:t,reactivate_existing:!0,send_welcome_email:!0};u&&(_.ip_address=u),c&&(_.user_agent=c),d&&(_.referring_site=d),l&&(_.utm_source=l),h&&(_.utm_medium=h),v&&(_.utm_campaign=v),x&&(_.utm_term=x),g&&(_.utm_content=g);let f=await fetch(`https://api.beehiiv.com/v2/publications/${s}/subscriptions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(_)});if(!f.ok){let e=await p(f);return o.NextResponse.json({error:"Failed to subscribe",details:e},{status:f.status})}let b=await f.json();return o.NextResponse.json({success:!0,data:b},{status:200})}catch(e){return o.NextResponse.json({error:"Unexpected server error"},{status:500})}}async function p(e){try{return await e.json()}catch{return await e.text()}}let c=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/subscribe/route",pathname:"/api/subscribe",filename:"route",bundlePath:"app/api/subscribe/route"},resolvedPagePath:"/Users/joaquinmancheno/Desktop/Personal/business/AutisticADHDco/AuDHD-Perspective/frontend/src/app/api/subscribe/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:m,serverHooks:l}=c;function h(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:m})}},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[447,580],()=>r(7965));module.exports=s})();